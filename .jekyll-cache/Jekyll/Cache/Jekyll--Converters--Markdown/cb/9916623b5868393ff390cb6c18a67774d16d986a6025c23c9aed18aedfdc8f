I"è<h2 id="introduction">Introduction</h2>

<p><a href="https://github.com/kubernetes/test-infra/tree/master/prow">Prow</a> is a Kubernetes based CI/CD system that has several types of jobs and is used at KubeVirt project.</p>

<p>General PRâ€™s, etc are tested by Prow to be validated to be reviewed by doing some sanity checks defined by developers.</p>

<p>In general, the internals on how it works can be checked at <a href="https://github.com/kubernetes/test-infra/blob/master/prow/life_of_a_prow_job.md">Life of a Prow Job</a>, and of course in the presentation made by <a href="https://github.com/jparrill">Juanma</a> on <a href="https://talks.godoc.org/github.com/jparrill/hands-on-prow/hands-on-prow.slide#1">https://talks.godoc.org/github.com/jparrill/hands-on-prow/hands-on-prow.slide#1</a>.</p>

<h2 id="community-repositories">Community repositories</h2>

<p>There are other repos (involved in the project ecosystem) that have tests to validate the information provided on them.</p>

<p>The community repositories include:</p>

<ul>
  <li><a href="https://github.com/kubevirt/kubevirt.github.io">KubeVirt website</a></li>
  <li><a href="https://github.com/kubevirt/kubevirt-tutorial">KubeVirt tutorial</a></li>
  <li><a href="https://github.com/metal3-io/metal3-io.github.io">Katacoda Scenarios</a></li>
  <li><a href="https://github.com/kubevirt/community">Community repo</a></li>
  <li><a href="https://github.com/kubevirt/cloud-image-builder">Cloud Image Builder</a></li>
</ul>

<p>Those repos contain useful information for new users, like the <code class="highlighter-rouge">try-it</code> scenarios, the Laboratories, <a href="https://katacoda.com/kubevirt">Katacoda scenarios</a>, Community supporting files (like logos, proposals, etc).</p>

<h2 id="the-jobs">The jobs</h2>

<p>For each repo weâ€™ve some types of jobs:</p>

<ul>
  <li><code class="highlighter-rouge">periodical</code>: Run automatically to validate that the repo, without further changes is still working (for example, detecting broken URLâ€™s).</li>
  <li><code class="highlighter-rouge">presubmit</code>: Validates that the incoming PR will not break the environment.</li>
  <li><code class="highlighter-rouge">post-submit</code>: After merging the PR, the repo is still working.</li>
</ul>

<p>Jobs are defined in the <a href="https://github.com/kubevirt/project-infra/">project-infra</a> repository, for example:</p>

<ul>
  <li><a href="https://github.com/kubevirt/project-infra/blob/master/github/ci/prow/files/jobs/kubevirt-tutorial/kubevirt-tutorial-periodics.yaml">https://github.com/kubevirt/project-infra/blob/master/github/ci/prow/files/jobs/kubevirt-tutorial/kubevirt-tutorial-periodics.yaml</a></li>
  <li><a href="https://github.com/kubevirt/project-infra/blob/master/github/ci/prow/files/jobs/kubevirt-tutorial/kubevirt-tutorial-presubmits.yaml">https://github.com/kubevirt/project-infra/blob/master/github/ci/prow/files/jobs/kubevirt-tutorial/kubevirt-tutorial-presubmits.yaml</a></li>
</ul>

<p>Those jobs define the image to use (image and tag), and the commands to execute. In the examples above weâ€™re using â€˜Docker-in-Dockerâ€™ (dind) images and weâ€™re targetting the KubeVirt-tutorial repository.</p>

<h3 id="kubevirt-tutorial">KubeVirt-tutorial</h3>

<p>The jobs, when executed as part of the Prow workflow, run the commands defined in the repo itself, for example for <code class="highlighter-rouge">kubevirt-tutorial</code> check the following folder:</p>

<ul>
  <li><a href="https://github.com/kubevirt/kubevirt-tutorial/tree/master/hack">https://github.com/kubevirt/kubevirt-tutorial/tree/master/hack</a></li>
</ul>

<p>That folder contains three scripts: <code class="highlighter-rouge">build</code>, <code class="highlighter-rouge">test_lab</code> and <code class="highlighter-rouge">tests</code>, which do setup the environment for running the validations, that is:</p>

<ul>
  <li>install required software on top of the used images.</li>
  <li>prepare the scripts to be executed via <a href="https://github.com/bashup/mdsh">mdsh</a> which extracts markdown from lab files to be executed against the cluster setup by Prow (using <code class="highlighter-rouge">dind</code>).</li>
  <li>Run each script and report status</li>
</ul>

<p>Once the execution has finished, if the final status is <code class="highlighter-rouge">ok</code>, the status is reported back to the GitHub PR so that it can be reviewed by mantainers of the repo.</p>

<h2 id="job-status">Job status</h2>

<p>The jobs executed and the logs are available on the Prow instance we use, for example:</p>

<ul>
  <li><a href="https://KubeVirt.io">https://KubeVirt.io</a>
    <ul>
      <li>Pre-submit link checker: <a href="https://prow.apps.ovirt.org/?job=kubevirt-io-presubmit-link-checker">https://prow.apps.ovirt.org/?job=kubevirt-io-presubmit-link-checker</a></li>
      <li>Periodical link checker: <a href="https://prow.apps.ovirt.org/?job=kubevirt-io-periodic-link-checker">https://prow.apps.ovirt.org/?job=kubevirt-io-periodic-link-checker</a></li>
    </ul>
  </li>
  <li><a href="https://github.com/kubevirt/kubevirt-tutorial">KubeVirt Tutorial</a>
    <ul>
      <li>Pre-submit: <a href="https://prow.apps.ovirt.org/?job=kubevirt-tutorial-presubmit-lab-testing-k8s-1.13.3">https://prow.apps.ovirt.org/?job=kubevirt-tutorial-presubmit-lab-testing-k8s-1.13.3</a></li>
      <li>Periodical: <a href="https://prow.apps.ovirt.org/?job=periodic-kubevirt-tutorial-lab-testing">https://prow.apps.ovirt.org/?job=periodic-kubevirt-tutorial-lab-testing</a></li>
    </ul>
  </li>
</ul>

<h2 id="wrap-up">Wrap-up</h2>

<p>If you find that a test should be performed to further validate the integrity and information provided, feel free to raise issues or even a PR against the <code class="highlighter-rouge">project-infra</code> repository so that we can get it improved!</p>
:ET