I"õ$<p>In this post we will install and configure Visual Studio Code (vscode) for KubeVirt development and debug.</p>

<p>Visual Studio Code is a source code editor developed by Microsoft for Windows, Linux and macOS.</p>

<p>It includes support for debugging, embedded Git control, syntax highlighting, intelligent code completion, snippets, and code refactoring.</p>

<h1 id="golang-installation">Golang Installation</h1>

<p>GO installation is required, We can find the binaries in <a href="https://golang.org/dl/">golang page</a>.</p>

<h2 id="golang-linux-installation">Golang Linux Installation</h2>

<p>After downloading the binaries extract them with the following command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -C /usr/local -xzf go$VERSION.$OS-$ARCH.tar.gz
</code></pre></div></div>

<p>Now let‚Äôs Add /usr/local/go/bin to the PATH environment variable.</p>

<p>You can do this by adding this line to your /etc/profile (for a system-wide installation) or $HOME/.profile:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PATH=$PATH:/usr/local/go/bin
</code></pre></div></div>

<h2 id="golang-windows-installation">Golang Windows Installation</h2>

<p>Open the MSI file and follow the prompts to install the Go tools.</p>

<p>By default, the installer puts the Go distribution in C:\Go.</p>

<p>The installer should put the C:\Go\bin directory in your PATH environment variable.</p>

<p>You may need to restart any open command prompts for the change to take effect.</p>

<h1 id="vscode-installation">VSCODE Installation</h1>

<p>Now we will install Visual Studio Code in our system.</p>

<h2 id="for-linux-machines">For linux machines</h2>

<p>We need to choose our linux distribution.</p>

<h3 id="for-rhelcentosfedora">For RHEL/Centos/Fedora</h3>

<p>The following script will install the key and repository:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc
sudo sh -c 'echo -e "[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" &gt; /etc/yum.repos.d/vscode.repo'
</code></pre></div></div>

<p>Then update the package cache and install the package using dnf (Fedora 22 and above):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dnf check-update
sudo dnf install code
</code></pre></div></div>

<p>Or on older versions using yum:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum check-update
sudo yum install code
</code></pre></div></div>

<h3 id="for-debianubuntu">For Debian/Ubuntu</h3>

<p>We need to download the .deb package from the <a href="https://code.visualstudio.com/Download">vscode download page</a>,
and from the command line run the package management.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo dpkg -i &lt;file&gt;.deb
sudo apt-get install -f # Install dependencies
</code></pre></div></div>

<h1 id="for-windows-machines">For Windows machines</h1>

<p>Download the <a href="https://go.microsoft.com/fwlink/?LinkID=534107">Visual Studio Code installer</a>, and then run the installer (VSCodeSetup-version.exe)</p>

<h1 id="go-project-struct">Go Project struct</h1>

<p>Let‚Äôs create the following structure for our kubevirt project development environment:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚îú‚îÄ‚îÄ &lt;Go-projects-folder&gt; # Your Golang projects root folder
‚îÇ   ‚îú‚îÄ‚îÄ bin
‚îÇ   ‚îú‚îÄ‚îÄ pkg
‚îÇ   ‚îú‚îÄ‚îÄ src
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kubevirt.io
</code></pre></div></div>

<p>Now navigate to kubevirt.io folder and run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone &lt;kubevirt-fork&gt;
</code></pre></div></div>

<h1 id="install-vscode-extensions">Install VSCODE Extensions</h1>

<p>Now we are going to install some extensions for a better development experience with the IDE.</p>

<p>Open vscode and select your go project root folder you created in the last step.</p>

<p>On the extensions tab (Ctrl+Shift+X), search for golang and install it.</p>

<p>Now open the command palette (Ctrl+Shift+P) view-&gt;Command Palette and type ‚ÄúGo: install/update tools‚Äù, this will install all the requirements for example: delve debugger, etc‚Ä¶</p>

<p>(optional) We can install docker extension for syntax highlighting, commands, etc..</p>

<p><img src="../assets/2018-05-22-Use-VS-Code-for-Kube-Virt-Development/extension-install.png" alt="Extension-Install" /></p>

<h1 id="gopath-and-goroot-configuration">GOPATH and GOROOT configuration</h1>

<p>Open the vscode configuration file (<code class="highlighter-rouge">ctrl+,</code>) file-&gt;preferences-&gt;settings.</p>

<p>Now on the right file we need to add this configuration:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"go.gopath": "&lt;Go-projects-folder&gt;",
"go.goroot": "/usr/local/go",
</code></pre></div></div>

<p><img src="../assets/2018-05-22-Use-VS-Code-for-Kube-Virt-Development/settings.png" alt="settings" /></p>

<h1 id="create-debug-configuration">Create debug configuration</h1>

<p>For the last part we are going to configure the debugger file, open it by Debug-&gt;Open Configurations and add to the configuration list the following structure</p>

<p>** Change the <Go-projects-folder> parameter to your golang projects root directory</Go-projects-folder></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">{</span>
  <span class="s2">"</span><span class="s">name"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Kubevirt"</span><span class="pi">,</span>
  <span class="s2">"</span><span class="s">type"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">go"</span><span class="pi">,</span>
  <span class="s2">"</span><span class="s">request"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">launch"</span><span class="pi">,</span>
  <span class="s2">"</span><span class="s">mode"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">debug"</span><span class="pi">,</span>
  <span class="s2">"</span><span class="s">remotePath"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span><span class="pi">,</span>
  <span class="s2">"</span><span class="s">port"</span><span class="pi">:</span> <span class="nv">2345</span><span class="pi">,</span>
  <span class="s2">"</span><span class="s">host"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">127.0.0.1"</span><span class="pi">,</span>
  <span class="s2">"</span><span class="s">program"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${fileDirname}"</span><span class="pi">,</span>
  <span class="s2">"</span><span class="s">env"</span><span class="pi">:</span> <span class="pi">{},</span>
  <span class="s2">"</span><span class="s">args"</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">--kubeconfig"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">cluster/k8s-1.9.3/.kubeconfig"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">--port"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">1234"</span><span class="pi">],</span>
  <span class="s2">"</span><span class="s">showLog"</span><span class="pi">:</span> <span class="nv">true</span><span class="pi">,</span>
  <span class="s2">"</span><span class="s">cwd"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${workspaceFolder}/src/kubevirt.io/kubevirt"</span><span class="pi">,</span>
  <span class="s2">"</span><span class="s">output"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;Go-projects-folder&gt;/bin/${fileBasenameNoExtension}"</span><span class="pi">,</span>
<span class="pi">}</span>
</code></pre></div></div>

<p><img src="../assets/2018-05-22-Use-VS-Code-for-Kube-Virt-Development/debug-config.png" alt="debug-config" /></p>

<h1 id="debug-process">Debug Process</h1>

<p>For debug we need to open the main package we want to debug.</p>

<p>For example if we want to debug the virt-api component, open the main package:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubevirt.io/cmd/virt-api/virt-api.go
</code></pre></div></div>

<p><img src="../assets/2018-05-22-Use-VS-Code-for-Kube-Virt-Development/debug-file.png" alt="debug-file" /></p>

<p>Now change to debug view (<code class="highlighter-rouge">ctrl+shift+D</code>), check that we are using the kubevirt configuration and hit the play button</p>

<p><img src="../assets/2018-05-22-Use-VS-Code-for-Kube-Virt-Development/debug-view.png" alt="debug-view" /></p>

<h2 id="more-information">More Information</h2>

<p>For more information, keyboard shortcuts and advance vscode usage please refer the following link</p>

<p><a href="https://code.visualstudio.com/docs/editor/codebasics">editor code basics</a></p>
:ET